<VirtualHost *:80>

  ServerName harrow.capistranorb.com

  AddHandler cgi-script .rb
  DocumentRoot "/opt/harrow/"

  RewriteEngine On
  RewriteRule ^/stats/harrow-installer-runs$ /capistrano-ping-stats.rb [L]
  RewriteRule ^/stats/gem-downloads$ /gem-download-stats.rb [L]
  RewriteRule ^/participate$ /participating.rb [L]
  RewriteRule ^/participating$ /participating.rb [L]

  # Disable the access log (might contain personally identifiable information
  # such as IP address)
  CustomLog /dev/null combined

  <Directory "/">
    Options -Indexes
    AllowOverride None
  </Directory>

  <Directory "/opt/harrow/">
    Require all granted
  </Directory>

  <Files "participating.rb">
    Options +ExecCGI
  </Files>

  <Files "gem-download-stats.rb">
    Options +ExecCGI
  </Files>

  <Files "capistrano-ping-stats.rb">
    Options +ExecCGI
  </Files>

</VirtualHost>
